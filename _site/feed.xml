<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" xml:lang="en"><generator uri="https://jekyllrb.com/" version="3.9.4">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" hreflang="en" /><updated>2025-12-21T17:42:55+09:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">Devlog</title><subtitle>Still hardworking</subtitle><author><name>이현동</name></author><entry><title type="html">광고 시스템 아키텍처</title><link href="http://localhost:4000/work/2025/12/21/cjone-ads-platform.html" rel="alternate" type="text/html" title="광고 시스템 아키텍처" /><published>2025-12-21T00:00:00+09:00</published><updated>2025-12-21T00:00:00+09:00</updated><id>http://localhost:4000/work/2025/12/21/cjone-ads-platform</id><content type="html" xml:base="http://localhost:4000/work/2025/12/21/cjone-ads-platform.html"><![CDATA[<h1 id="광고-트래킹-시스템-아키텍처">광고 트래킹 시스템 아키텍처</h1>

<p><img src="/_img/광고시스템.png" alt="" /></p>]]></content><author><name>[&quot;이현동&quot;]</name></author><category term="Work" /><category term="광고" /><summary type="html"><![CDATA[광고 트래킹 시스템 아키텍처]]></summary></entry><entry><title type="html">단위 테스트코드 작성기</title><link href="http://localhost:4000/work/2025/02/11/%EC%9A%B0%EB%8B%B9%ED%83%95%ED%83%95-test-code-%EC%9E%91%EC%84%B1%EA%B8%B0.html" rel="alternate" type="text/html" title="단위 테스트코드 작성기" /><published>2025-02-11T00:00:00+09:00</published><updated>2025-02-11T00:00:00+09:00</updated><id>http://localhost:4000/work/2025/02/11/%EC%9A%B0%EB%8B%B9%ED%83%95%ED%83%95-test-code-%EC%9E%91%EC%84%B1%EA%B8%B0</id><content type="html" xml:base="http://localhost:4000/work/2025/02/11/%EC%9A%B0%EB%8B%B9%ED%83%95%ED%83%95-test-code-%EC%9E%91%EC%84%B1%EA%B8%B0.html"><![CDATA[<h2 id="모두가-작성하지-않지만-코드-품질을-위하여">모두가 작성하지 않지만 코드 품질을 위하여..</h2>

<p>현재 프로젝트에서 사용하고 있는 기술스택은 …
이러한 이유로 테스트 코드를 작성하기로 결심했다.
어떤 테스트 코드를 작성해야할까..? 결론은 slice 테스트가 유일한 길이었다.
현재 service, controller 레이어만 테스트를 작성한 상태
service -&gt; Mock
controller -&gt; Mock
mapper -&gt; 통합테스트를 적용하여 개발 db에 붙여보기 도전중..</p>

<h3 id="mock-spy-그리고">Mock, Spy.. 그리고</h3>

<h3 id="dao-테스트">Dao 테스트</h3>
<p>현재 Mybatis 중에서도 dao 방식으로 데이터에 접근하도록 구축되어 있다. 하지만 여러 의존성 이슈..</p>

<p>MSA로 구성되었다.. 하지만 모노리식, 멀티모듈 구조라는 표현이 더 적합하다고 생각한다.</p>

<p>메인 모듈에서 모든 설정과 의존성 주입된다. 서브모듈을 라이브러리 형식으로 main애서 implement하여 사용한다.
이러한 문제로 config나 주입을 하기위해 여러가지를 고민해야 했다.</p>

<ol>
  <li>데이터에 접근하는 공통 dao 설정만 따로 분리 -&gt; 시도중</li>
  <li>main 모듈을 testImplement하여 사용 -&gt; 실패
3.</li>
</ol>

<hr />

<p><strong>목차</strong></p>
<ul>
  <li><a href="#테스트-방식-선정-단계">테스트방식 선정 단계</a></li>
  <li><a href="#JUnit">JUnit</a></li>
  <li><a href="#TestDouble">TestDouble</a>
    <ul>
      <li>Stub</li>
      <li>Mock</li>
      <li>Spy</li>
    </ul>
  </li>
  <li><a href="">Repository Layer Test 예시</a></li>
  <li><a href="">Service Layer Test 예시</a></li>
  <li><a href="">Controller Layer Test 예시</a></li>
  <li>추후 개선할 수 있는 내용</li>
</ul>

<p>테스트 코드를 작성하며 겪게된 여래 시행착오와 배웠던 점을 간단하게 정리해보려고 한다.
본 프로젝트에서 사용하는 스택과 구조에 대하여 간단하게 설명을 하고 테스트에 대하여 알아보자.</p>
<ul>
  <li>Jdk 17.0.14</li>
  <li>Junit 5.10.5</li>
  <li>Mybatis3.0.3</li>
  <li>Spring-boot 3.3.8 (&gt;canalFrame)</li>
</ul>

<p>위 스펙을 사용하여 멀티모듈 구조로 이루어져 있다. 예를 들어 A, B, C라는 도메인들이 있고 하나의 도메인 A에서 B, C를 implement하여 사용하고 있는 구조이다.
A -&gt; B, C</p>

<p>즉, 모든 설정에 관련된 정보는 메인 모듈 A에 의존적이다. 이 구조로 SpringBootApplication이 A 모듈에만 존재하기 때문에 B, C 모듈에서는 이 의존성을 주입해줄 방법이 없었다.</p>

<p>더 쉽게 말해 datasource를 통하여 DB Connection을 찾아가야 하는데 datasource에 관련된 설정은 A 모듈에만 존재하기 때문에 B, C 모듈에서는 새로운 설정을 할 필요했다.</p>

<p><br /></p>

<h4 id="테스트-방식-선정-단계">테스트 방식 선정 단계</h4>
<blockquote>
  <p>테스트를 작성하기 전에 Mock사용하여 단위테스트를 진행할지 통합 테스트를 하는것이 좋을까?</p>
</blockquote>

<p>이 고민은 초기에 Application Context에 Bean을 등록할 수 없는 문제로 종결되었다. 단위테스트를 하기로 마음을 먹었으며, 단위 테스트를 하게 될때 장점은 아래와 같다.</p>

<p>단위테스트는 단순한 오류를 찾는 것이 아니다. 각각의 컴포넌트, 즉 단위 별로 독립적으로 잘 동작을 하는지 검증하는 것이다. 각각의 단위를 조립 했을때 유기적으로 코드가 흘러가는 것을 가정하며 진행한다.</p>

<h5 id="단위테스트-vs-통합테스트">단위테스트 VS. 통합테스트</h5>
<p><code class="language-plaintext highlighter-rouge">단위테스트</code></p>
<ul>
  <li>하나의 컴포넌트를 기준으로 독립적으로 진행되는 가장 작은 단위의 테스트</li>
  <li>컴포넌트는 하나의 기능 또는 메소드</li>
  <li>어떤 기능이 실행되면 어떤 결과가 나오도록 테스트하는 것</li>
</ul>

<p><code class="language-plaintext highlighter-rouge">통합테스트</code></p>
<ul>
  <li>모듈을 통합하는 과정에서 모듈 간의 호환성을 확인하는 테스트
    <ul>
      <li>A service를 호출하는 B Service와 각각 database에서 값을 읽어와 상호작용하여 기댓값을 잘 봔환하는지 확인</li>
    </ul>
  </li>
  <li>모든 통합된 컴포넌트들이 연계되어 동작하는지 검증</li>
</ul>

<h5 id="단위테스트의-문제점">단위테스트의 문제점</h5>
<p>구조적으로 1개의 애플리케이션은 또 다른 1개의 객체와 메시지를 주고 받아야한다. 앞서 한개의 컴포넌트 단위로 테스트를 독립적으로 테스트 해야하기 때문에 다른 객체를 호출할때 문제가 있을 수 있다.
이러한 경우 Stubbing을 통하여 문제를 해결할 수 있다.</p>

<p><br /></p>

<h3 id="junit">JUnit</h3>
<h3 id="given-when-then">given-when-then</h3>
<p>강의나 대부분의 실무에서 해당 패턴을 활용하여 테스트 코드를 작성한다.</p>

<p><strong>패턴</strong>
given - 어떤 데이터가 준비되었을때 - 준비
when - 테스트할 컴포넌트를 실행하면 - 실행
then - 어떠한 결과가 나올것 - 검증
해당 패턴을 활용하여 개발을 진행했으며 간혹 verify를 통하여 호출 횟수를 검증하기도 했다.</p>

<p><strong>예시코드</strong></p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>  
<span class="nd">@DisplayName</span><span class="o">(</span><span class="s">"01_판매번호_종합조회_기본조회"</span><span class="o">)</span>  
<span class="kt">void</span> <span class="nf">searchSalesNo</span><span class="o">()</span> <span class="o">{</span>  
    <span class="c1">// given  </span>
    <span class="nc">SalesNoLtgrSttusResDto</span> <span class="n">expected</span> <span class="o">=</span>  
            <span class="nc">SalesNoLtgrSttusResDto</span><span class="o">.</span><span class="na">builder</span><span class="o">()</span>  
                    <span class="o">.</span><span class="na">coCd</span><span class="o">(</span><span class="no">CO_CD</span><span class="o">)</span>  
                    <span class="o">.</span><span class="na">outwhSalNo</span><span class="o">(</span><span class="no">SAL_NO</span><span class="o">)</span>  
                    <span class="o">.</span><span class="na">build</span><span class="o">();</span>  
  
  
    <span class="n">given</span><span class="o">(</span><span class="n">userContext</span><span class="o">.</span><span class="na">getCoCd</span><span class="o">()).</span><span class="na">willReturn</span><span class="o">(</span><span class="no">CO_CD</span><span class="o">);</span>  
    <span class="n">given</span><span class="o">(</span><span class="n">commonDao</span><span class="o">.</span><span class="na">selectList</span><span class="o">(</span><span class="s">"salesNoLtgrSttusService.searchSalesNo"</span><span class="o">,</span> <span class="n">reqDto</span><span class="o">)).</span><span class="na">willReturn</span><span class="o">(</span><span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">expected</span><span class="o">));</span>  
    <span class="c1">//when  </span>
  
    <span class="n">when</span><span class="o">(</span><span class="n">salesNoLtgrSttusService</span><span class="o">.</span><span class="na">searchSalesNo</span><span class="o">(</span><span class="n">reqDto</span><span class="o">)).</span><span class="na">thenReturn</span><span class="o">(</span><span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">expected</span><span class="o">));</span>  
  
    <span class="c1">//then  </span>
    <span class="n">assertThat</span><span class="o">(</span><span class="n">salesNoLtgrSttusService</span><span class="o">.</span><span class="na">searchSalesNo</span><span class="o">(</span><span class="n">reqDto</span><span class="o">)).</span><span class="na">isEqualTo</span><span class="o">(</span><span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">expected</span><span class="o">));</span>  
    <span class="n">verify</span><span class="o">(</span><span class="n">commonDao</span><span class="o">).</span><span class="na">selectList</span><span class="o">(</span><span class="s">"salesNoLtgrSttusService.searchSalesNo"</span><span class="o">,</span> <span class="n">reqDto</span><span class="o">);</span>  
<span class="o">}</span>
</code></pre></div></div>

<p>테스트를 위하여 필요한 함수가 별도로 있으면 테스트 코드 내부에 선언하여 사용해도 괜찮다.
spring-test와 junit-jupiter 각각의 역할을 제대로 구분짓고 가보려고 한다.</p>

<p><br /><br /></p>

<h5 id="junit-5와-spring의-역할-구분"><strong>JUnit 5와 Spring의 역할 구분</strong></h5>

<h6 id="junit-5-junit-jupiter">JUnit 5 (<code class="language-plaintext highlighter-rouge">junit-jupiter</code>)</h6>

<ul>
  <li>테스트 프레임워크</li>
  <li><strong>테스트 실행</strong>과<strong>생명주기 관리</strong>
    <h6 id="spring-springboottestcontextconfiguration">Spring (<code class="language-plaintext highlighter-rouge">@SpringBootTest</code>,<code class="language-plaintext highlighter-rouge">@ContextConfiguration</code>)</h6>
  </li>
  <li><strong>애플리케이션 컨텍스트 관리</strong></li>
  <li><strong>의존성 주입</strong>및<strong>테스트 컨텍스트 초기화</strong></li>
</ul>

<p>이 두 역할을 명확히 구분할 필요가 있다. 특히<strong>테스트 컨텍스트 초기화 시점</strong>과<strong>테스트 실행 시점의 차이</strong>는 중요한 개념이다.</p>

<p>예를 들어,<strong>Jasypt</strong>와 같은 암호화 알고리즘을 활용해<strong>yml 파일</strong>에 암호화된 정보를 저장하고 이를 복호화하여<strong>DataSource</strong>에 등록하려 할 때,<strong>복호화 과정이 DataSource 초기화 시점보다 우선되어야</strong>한다.</p>

<p>하지만<strong>JUnit 5의 테스트 실행 순서</strong>는<strong>Spring 컨텍스트 초기화와 시점 차이</strong>가 발생할 수 있다.
특히<strong>HikariCP 초기화 시점</strong>과<strong>Spring 컨텍스트에서<code class="language-plaintext highlighter-rouge">StringEncryptor</code>빈 등록 시점이 엇갈리면</strong>, DataSource가<strong><code class="language-plaintext highlighter-rouge">ENC(...)</code>값을 그대로 사용</strong>해 <code class="language-plaintext highlighter-rouge">ORA-01017: invalid username/password</code>와 같은 오류가 발생할 수 있다.</p>

<p>뿐만아니라 공부를 하면서 학습한 내용으로 테스트코드에서는 생성자 주입으로 의존성을 주입하기 위해서는 @TestContructor라는 별도의 어노테이션을 작성해줘야 한다.</p>

<p><strong>예시코드</strong></p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// SpringExtension.class 내부</span>
<span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">supportsParameter</span><span class="o">(</span><span class="nc">ParameterContext</span> <span class="n">parameterContext</span><span class="o">,</span> <span class="nc">ExtensionContext</span> <span class="n">extensionContext</span><span class="o">)</span> <span class="o">{</span>  
    <span class="nc">Parameter</span> <span class="n">parameter</span> <span class="o">=</span> <span class="n">parameterContext</span><span class="o">.</span><span class="na">getParameter</span><span class="o">();</span>  
    <span class="nc">Executable</span> <span class="n">executable</span> <span class="o">=</span> <span class="n">parameter</span><span class="o">.</span><span class="na">getDeclaringExecutable</span><span class="o">();</span>  
    <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">testClass</span> <span class="o">=</span> <span class="n">extensionContext</span><span class="o">.</span><span class="na">getRequiredTestClass</span><span class="o">();</span>  
    <span class="nc">PropertyProvider</span> <span class="n">junitPropertyProvider</span> <span class="o">=</span> <span class="o">(</span><span class="n">propertyName</span><span class="o">)</span> <span class="o">-&gt;</span> <span class="o">{</span>  
        <span class="k">return</span> <span class="o">(</span><span class="nc">String</span><span class="o">)</span><span class="n">extensionContext</span><span class="o">.</span><span class="na">getConfigurationParameter</span><span class="o">(</span><span class="n">propertyName</span><span class="o">).</span><span class="na">orElse</span><span class="o">((</span><span class="nc">Object</span><span class="o">)</span><span class="kc">null</span><span class="o">);</span>  
    <span class="o">};</span>  
    <span class="c1">// 테스트</span>
    <span class="k">return</span> <span class="nc">TestConstructorUtils</span><span class="o">.</span><span class="na">isAutowirableConstructor</span><span class="o">(</span><span class="n">executable</span><span class="o">,</span> <span class="n">testClass</span><span class="o">,</span> <span class="n">junitPropertyProvider</span><span class="o">)</span> <span class="o">||</span> <span class="nc">ApplicationContext</span><span class="o">.</span><span class="na">class</span><span class="o">.</span><span class="na">isAssignableFrom</span><span class="o">(</span><span class="n">parameter</span><span class="o">.</span><span class="na">getType</span><span class="o">())</span> <span class="o">||</span> <span class="k">this</span><span class="o">.</span><span class="na">supportsApplicationEvents</span><span class="o">(</span><span class="n">parameterContext</span><span class="o">)</span> <span class="o">||</span> <span class="nc">ParameterResolutionDelegate</span><span class="o">.</span><span class="na">isAutowirable</span><span class="o">(</span><span class="n">parameter</span><span class="o">,</span> <span class="n">parameterContext</span><span class="o">.</span><span class="na">getIndex</span><span class="o">());</span>  
<span class="o">}</span>


<span class="c1">// TestConstructorUtils.class</span>
<span class="cm">/**
* 아래 @TestConstructor가 있다면 supportsParameter를 통하여 생성자 주입을 가능하게 한다.
*/</span>
<span class="kd">public</span> <span class="kd">static</span> <span class="kt">boolean</span> <span class="nf">isAutowirableConstructor</span><span class="o">(</span><span class="nc">Constructor</span><span class="o">&lt;?&gt;</span> <span class="n">constructor</span><span class="o">,</span> <span class="nc">Class</span><span class="o">&lt;?&gt;</span> <span class="n">testClass</span><span class="o">,</span> <span class="nd">@Nullable</span> <span class="nc">PropertyProvider</span> <span class="n">fallbackPropertyProvider</span><span class="o">)</span> <span class="o">{</span>  
    <span class="k">if</span> <span class="o">(</span><span class="n">isAnnotatedWithAutowiredOrInject</span><span class="o">(</span><span class="n">constructor</span><span class="o">))</span> <span class="o">{</span>  
        <span class="k">return</span> <span class="kc">true</span><span class="o">;</span>  
    <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>  
        <span class="nc">TestConstructor</span> <span class="n">testConstructor</span> <span class="o">=</span> <span class="o">(</span><span class="nc">TestConstructor</span><span class="o">)</span><span class="nc">TestContextAnnotationUtils</span><span class="o">.</span><span class="na">findMergedAnnotation</span><span class="o">(</span><span class="n">testClass</span><span class="o">,</span> <span class="nc">TestConstructor</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>  
        <span class="nc">TestConstructor</span><span class="o">.</span><span class="na">AutowireMode</span> <span class="n">autowireMode</span><span class="o">;</span>  
        <span class="k">if</span> <span class="o">(</span><span class="n">testConstructor</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>  
            <span class="n">autowireMode</span> <span class="o">=</span> <span class="n">testConstructor</span><span class="o">.</span><span class="na">autowireMode</span><span class="o">();</span>  
        <span class="o">}</span> <span class="k">else</span> <span class="o">{</span>  
            <span class="nc">String</span> <span class="n">value</span> <span class="o">=</span> <span class="nc">SpringProperties</span><span class="o">.</span><span class="na">getProperty</span><span class="o">(</span><span class="s">"spring.test.constructor.autowire.mode"</span><span class="o">);</span>  
            <span class="n">autowireMode</span> <span class="o">=</span> <span class="nc">AutowireMode</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>  
            <span class="k">if</span> <span class="o">(</span><span class="n">autowireMode</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">&amp;&amp;</span> <span class="n">fallbackPropertyProvider</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>  
                <span class="n">value</span> <span class="o">=</span> <span class="n">fallbackPropertyProvider</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="s">"spring.test.constructor.autowire.mode"</span><span class="o">);</span>  
                <span class="n">autowireMode</span> <span class="o">=</span> <span class="nc">AutowireMode</span><span class="o">.</span><span class="na">from</span><span class="o">(</span><span class="n">value</span><span class="o">);</span>  
            <span class="o">}</span>  
        <span class="o">}</span>  
        <span class="k">return</span> <span class="n">autowireMode</span> <span class="o">==</span> <span class="nc">AutowireMode</span><span class="o">.</span><span class="na">ALL</span><span class="o">;</span>  
    <span class="o">}</span>  
<span class="o">}</span>

</code></pre></div></div>

<ul>
  <li>Spring의<code class="language-plaintext highlighter-rouge">@Autowired</code>와 JUnit 5의<code class="language-plaintext highlighter-rouge">ParameterResolver</code>는 서로 다른 목적과 방식으로 동작한다.</li>
  <li>Spring은 <strong>필드 주입(@Autowired)</strong> 을 주로 사용하며, JUnit 5의<code class="language-plaintext highlighter-rouge">ParameterResolver</code>는 메서드 매개변수 주입을 위한 것이다.</li>
  <li>JUnit 5 테스트에서<code class="language-plaintext highlighter-rouge">@ExtendWith(SpringExtension.class)</code>와 함께 Spring 컨텍스트에서 일부 매개변수 주입이 가능하다.</li>
</ul>

<p>실제로 설정정보에 관한 의존성을 주입해주기 위해서는 다음과 같은 코드를 사용했습니다.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@SpringBootTest</span><span class="o">(</span><span class="n">classes</span> <span class="o">=</span> <span class="o">{</span><span class="nc">TestConfiguration</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>  
<span class="nd">@Import</span><span class="o">({</span><span class="nc">JasyptConfig</span><span class="o">.</span><span class="na">class</span><span class="o">,</span> <span class="nc">TestConfig</span><span class="o">.</span><span class="na">class</span><span class="o">})</span>  
<span class="nd">@Slf4j</span>  
<span class="nd">@ActiveProfiles</span><span class="o">(</span><span class="s">"test"</span><span class="o">)</span>  
<span class="nd">@RequiredArgsConstructor</span> <span class="c1">// 생성자 생성</span>
<span class="nd">@TestConstructor</span><span class="o">(</span><span class="n">autowireMode</span> <span class="o">=</span> <span class="nc">TestConstructor</span><span class="o">.</span><span class="na">AutowireMode</span><span class="o">.</span><span class="na">ALL</span><span class="o">)</span>  
<span class="kd">class</span> <span class="nc">DITest</span> <span class="o">{</span>

	
	<span class="kd">private</span> <span class="kd">final</span> <span class="nc">ApplicationContext</span> <span class="n">applicationContext</span><span class="o">;</span>  
	
	<span class="c1">// spring이 생성자 주입을 해주는 대상</span>
	<span class="kd">private</span> <span class="kd">final</span>  <span class="nc">CommonDao</span> <span class="n">commonDao</span><span class="o">;</span>

	<span class="nd">@Test</span>  
	<span class="kt">void</span> <span class="n">의존성_주입_테스트</span><span class="o">()</span> <span class="o">{</span>  
	    <span class="c1">//given  </span>
	    <span class="nc">String</span><span class="o">[]</span> <span class="n">beanDefinitionNames</span> <span class="o">=</span> <span class="n">applicationContext</span><span class="o">.</span><span class="na">getBeanDefinitionNames</span><span class="o">();</span>  
	    <span class="k">for</span> <span class="o">(</span><span class="nc">String</span> <span class="n">beanDefinitionName</span> <span class="o">:</span> <span class="n">beanDefinitionNames</span><span class="o">)</span> <span class="o">{</span>  
	        <span class="n">log</span><span class="o">.</span><span class="na">debug</span><span class="o">(</span><span class="s">"[TEST DEBUG] beanDefinitionName : {}"</span><span class="o">,</span> <span class="n">beanDefinitionName</span><span class="o">);</span>  
	    <span class="o">}</span>  
	    <span class="c1">//when-then  </span>
	    <span class="n">assertThat</span><span class="o">(</span><span class="n">applicationContext</span><span class="o">.</span><span class="na">getBeanNamesForType</span><span class="o">(</span><span class="nc">CommonDao</span><span class="o">.</span><span class="na">class</span><span class="o">)).</span><span class="na">isNotEmpty</span><span class="o">();</span>  
	<span class="o">}</span>
	
	<span class="o">...</span>

<span class="o">}</span>
</code></pre></div></div>

<p><br /></p>

<p>테스트 코드 실행 결과
![[Pasted image 20250214132947.png]]</p>

<p>Test를 하기위한 Context만 Load되는것을 실행 화면에서 확인할 수 있다.</p>

<p><br /><br /><br />
<br /></p>

<h1 id="test-double테스트-대역">Test Double(테스트 대역)</h1>

<blockquote>
  <p>위 세가지 모두 테스트에서 의존성이나 외부 객체 동작을 제어하거나 검증하기 위해 사용하는 Test Double(테스트 대역)이다.</p>
  <ul>
    <li>테스트 대역은 실제 객체를 대체하지만, 완전히 동일한 기능을 제공하는 것이 아닌 특정 목적에 맞게 동작을 변경하는 것이다.</li>
  </ul>
</blockquote>

<p>| 종류       | 실제 객체 대신하는 방식     |
| ——– | —————– |
| <strong>Stub</strong> | 고정된 값을 반환하여 출력 제어 |
| <strong>Mock</strong> | 메서드 호출 여부 검증      |
| <strong>Spy</strong>  | 실제 객체 + 일부 동작 조작  |</p>
<h3 id="테스트-대역을-사용하는-이유">테스트 대역을 사용하는 이유</h3>
<blockquote>
  <p>단위 테스트를 하고 싶다.</p>
</blockquote>

<h4 id="service-작성하여-test-시">Service 작성하여 test 시</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">SalLdgrServiceTest</span> <span class="o">{</span>  
    
    <span class="kd">private</span> <span class="nc">SalLdgrService</span> <span class="n">salLdgrService</span><span class="o">;</span>

	<span class="nd">@Test</span>
	<span class="kt">void</span> <span class="nf">createSalLdgr</span><span class="o">()</span> <span class="o">{</span>
		<span class="c1">// 전역 사용자 생성</span>
		<span class="nc">UserContext</span> <span class="n">userContext</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">UserContext</span><span class="o">();</span>
		<span class="c1">// 공용 dao 객체 생성</span>
		<span class="nc">CommonDao</span> <span class="n">commonDao</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">CommonDao</span><span class="o">(</span><span class="n">userContext</span><span class="o">);</span>
		<span class="c1">// salLdgrService 생성</span>
		<span class="n">salLdgrService</span><span class="o">(</span><span class="n">commonDao</span><span class="o">);</span>
		
		<span class="nc">SalLdgrRequestDto</span> <span class="n">reqDto</span><span class="o">;</span>

		<span class="c1">//원장 생성</span>
		<span class="n">salLdgrService</span><span class="o">.</span><span class="na">createSalLdgr</span><span class="o">(</span><span class="n">reqDto</span><span class="o">);</span>
	<span class="o">}</span>


</code></pre></div></div>

<p>위와 같은 특정 Service를 테스트 하기 위해서는 하단에 조건이 충족 되어야 한다.</p>
<ul>
  <li>RDB Connection 세팅</li>
  <li>RDB에 로직 테스트 조건에 맞는 데이터 세팅</li>
  <li>CommonDao에서 사용 SqlSessionFactory 생성 및 주입</li>
  <li>createSalLdgr 테스트 이후에 test Data rollback 등..</li>
</ul>

<p>모두 작성하지 않았지만 고려해야할 내용이 너무 많다. 만약 더 복잡한 로직이라면 추가해줘야할 의존성과 설정이 너무 많기 때문에 slice 테스트를 진행하는 것이 유리한 경우가 꽤 있다. 뿐만 아니라 위와 같은 설정과 정보를 가져오는데 <code class="language-plaintext highlighter-rouge">속도 저하</code>는 피할 수 없다.</p>

<h4 id="service-메서드-관점에서-db나-여러-정보에-대하여-관심이-딱히-없다">Service 메서드 관점에서 DB나 여러 정보에 대하여 관심이 딱히 없다.</h4>
<blockquote>
  <p>우리가 검증해야 하는 주된 내용은</p>
  <ul>
    <li>createSalLdgr이 1회 정상 호출 됐는지</li>
    <li>createSalLdgr 실행시에 DuplicateException과 같은 예외가 정상적으로 발생하는지</li>
    <li>createSalLdgr 내부 타 로직 호출 내용이 정상 실행되는지</li>
  </ul>
</blockquote>

<p>온통 SalLdgrService에 관련되 내용 뿐이다.
이러한 이유에서 아래와 같은 테스트 대역들이 등장 했으며 자세하게 한번 살표보자.</p>

<p><br /></p>

<h2 id="stub">Stub</h2>
<blockquote>
  <p>고정된 값을 반환하거나 미리 정의된 동작을 수행하는 테스트 대역이다</p>
</blockquote>

<ul>
  <li>고정된 값을 반환하여 예측 가능한 값을 반환하도록 동작을 미리 정의한다.</li>
  <li>동작만 제공하며 검증을 하지 않는다. (이 기능은 메소드 호출여부나 몇번 호출했는지 확인하는 기능이 없다는 의미로 mockicto에 포함되어 있는 기능이다)</li>
  <li>상태 기반의 테스트에 적합하기 때문에 테스트 결과가 특정 상태와 일치하는지 확인할 때 사용한다.</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">class</span> <span class="nc">StringServiceStub</span> <span class="n">extneds</span> <span class="nc">StringService</span> <span class="o">{</span>
	<span class="nd">@Overide</span>
	<span class="kd">public</span> <span class="nc">String</span> <span class="nf">concatString</span><span class="o">(</span><span class="nc">String</span> <span class="n">s1</span><span class="o">,</span> <span class="nc">String</span> <span class="n">s2</span><span class="o">){</span>
		<span class="c1">// 실제 로직을 무시하며 hello만 항상 반환한다.</span>
		<span class="k">return</span> <span class="s">"hello"</span><span class="o">;</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>위와 같은 로직을 stubbing이라고 볼 수 있다.</p>

<p><br /></p>

<h2 id="mock">Mock</h2>
<blockquote>
  <p>mock이란 ‘모의, 가짜’란 의미이다. 테스트할 때 필요한 실제 객체와 동일한 가짜 객체를 만들어 사용하는 객체로 Mock Object가 있다. 매소드 호출여부, 호출 횟수, 전달된 인자를 검증 가능한 테스트 대역이다.</p>
</blockquote>

<ul>
  <li>행위 기반 테스트에 적합하며 호출 여부와 호출 패턴을 검증한다.</li>
  <li>테스트 중 동적으로 행동을 정의할 수 있다.</li>
  <li>Moclito 라이브러리에서 기능 제공</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Mockito 사용 예제</span>
<span class="nd">@ExtendWith</span><span class="o">(</span><span class="nc">MockitoExtension</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">StringServiceTest</span> <span class="o">{</span>
	<span class="c1">// @Mock - mocking할 객체 위에 작성한다.</span>
	<span class="nd">@InjectMock</span> <span class="c1">// @Mock 들을 해당 어노테이션이 붙은 객체들에게 주입한다.</span>
	<span class="kd">private</span> <span class="nc">StringService</span> <span class="n">stringService</span><span class="o">;</span>

	<span class="kt">void</span> <span class="n">문자열_붙이기_테스트</span><span class="o">()</span> <span class="o">{</span>
		<span class="c1">// given</span>
		<span class="nc">String</span> <span class="n">s1</span> <span class="o">=</span> <span class="s">"hell"</span><span class="o">;</span>
		<span class="nc">String</span> <span class="n">s2</span> <span class="o">=</span> <span class="s">"o"</span><span class="o">;</span>
		<span class="nc">String</span> <span class="n">expected</span> <span class="o">=</span> <span class="s">"hello"</span><span class="o">;</span>
		
		<span class="c1">// when - mocking</span>
		<span class="n">when</span><span class="o">(</span><span class="n">stringService</span><span class="o">.</span><span class="na">concatString</span><span class="o">(</span><span class="n">s1</span><span class="o">,</span> <span class="n">s2</span><span class="o">)).</span><span class="na">thenReturn</span><span class="o">(</span><span class="n">expected</span><span class="o">);</span>

		<span class="c1">// then mock 객체의 행위 검증</span>
		<span class="n">verify</span><span class="o">(</span><span class="n">stringService</span><span class="o">).</span><span class="na">concatString</span><span class="o">(</span><span class="n">s1</span><span class="o">,</span> <span class="n">s2</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p><br /></p>

<h2 id="spy">Spy</h2>
<blockquote>
  <p>Spy는 실제 객체를 감싸면서 일부 메서드만 Stub처럼 동작하도록 구현하며, 기본적으로 실제 메서드가 호출되지만 특정 메서드는 조작이 가능한 형태이다.</p>
</blockquote>

<ul>
  <li>실제 동작과 스텁 동작 혼합 가능</li>
  <li>부분적인 검증이나 메서드 조작에 용이</li>
</ul>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// Mockito 사용 예제</span>
<span class="nd">@ExtendWith</span><span class="o">(</span><span class="nc">MockitoExtension</span><span class="o">.</span><span class="na">class</span><span class="o">)</span>
<span class="kd">class</span> <span class="nc">StringServiceTest</span> <span class="o">{</span>
	<span class="c1">// @Spy - mocking할 Spy 객체 지정</span>
	<span class="nd">@Inject</span><span class="err"></span><span class="nc">Mocks</span> <span class="c1">// @Spy 객체를 주입하여 InjectMocks 객체를 생성</span>
	<span class="kd">private</span> <span class="nc">StringService</span> <span class="n">stringService</span><span class="o">;</span>

	<span class="kt">void</span> <span class="n">문자열_붙이기_테스트</span><span class="o">()</span> <span class="o">{</span>
		<span class="c1">// given</span>
		<span class="nc">String</span> <span class="n">s1</span> <span class="o">=</span> <span class="s">"hell"</span><span class="o">;</span>
		<span class="nc">String</span> <span class="n">s2</span> <span class="o">=</span> <span class="s">"o"</span><span class="o">;</span>
		<span class="nc">String</span> <span class="n">expected</span> <span class="o">=</span> <span class="s">"hello"</span><span class="o">;</span>
		
		<span class="c1">// when - mocking</span>
		<span class="n">stringService</span><span class="o">.</span><span class="na">concatString</span><span class="o">(</span><span class="n">s1</span><span class="o">,</span> <span class="n">s2</span><span class="o">);</span>

		<span class="c1">// then mock 객체의 행위 검증, 실제 함수를 호출하여 1회 실행됐는지</span>
		<span class="n">verify</span><span class="o">(</span><span class="n">stringService</span><span class="o">,</span> <span class="n">times</span><span class="o">(</span><span class="mi">1</span><span class="o">)).</span><span class="na">concatString</span><span class="o">(</span><span class="n">s1</span><span class="o">,</span> <span class="n">s2</span><span class="o">);</span>
	<span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>]]></content><author><name>[&quot;이현동&quot;]</name></author><category term="Work" /><category term="test" /><summary type="html"><![CDATA[모두가 작성하지 않지만 코드 품질을 위하여..]]></summary></entry><entry><title type="html">cgvNext 프로젝트 개발기</title><link href="http://localhost:4000/work/2024/12/08/cgv-next-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EA%B0%9C%EB%B0%9C%EA%B8%B0.html" rel="alternate" type="text/html" title="cgvNext 프로젝트 개발기" /><published>2024-12-08T00:00:00+09:00</published><updated>2024-12-08T00:00:00+09:00</updated><id>http://localhost:4000/work/2024/12/08/cgv-next-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EA%B0%9C%EB%B0%9C%EA%B8%B0</id><content type="html" xml:base="http://localhost:4000/work/2024/12/08/cgv-next-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8-%EA%B0%9C%EB%B0%9C%EA%B8%B0.html"><![CDATA[<h2 id="프로젝트-투입전-목표">프로젝트 투입전 목표</h2>

<ul>
  <li>동료들도 이용할 수 있는 코드 작성</li>
  <li>학습한 <strong>design pattern</strong>을 service에 적용</li>
  <li><strong>test code</strong> 작성</li>
  <li>선언적 프로그래밍</li>
</ul>

<h2 id="동료들도-이용할-수-있는-코드">동료들도 이용할 수 있는 코드</h2>

<p>프로젝트에서 민감정보 마스킹 처리와 해제에 관련하여 가이드가 내려왔다.</p>
<ol>
  <li>민감정보는 마스킹 처리를 해야한다. 마스킹 처리는 MaskUtil 내에 있는 메서드를 이용한다.</li>
  <li>마스킹 해제 시에 로깅 서비스를 호출해야 한다.</li>
</ol>

<p>기존에 공통 팀에서 개발해준대로 사용해도 됐지만 뭔가 좀 더 간편한 방법으로 해결하고 싶었다. 그래서 나는 위 두가지 가이드를
목표로 잡아 해결하려고 했다. 우선 해결 방법으로 생각한것은
1번은 JsonSerialize되는 시점에 dto에 @Mask 어노테이션이 붙어 있을때 마스킹 처리를 하도록 고안했다.</p>

<p>2번은 Aop를 사용하여 @MaskApplyLog(uri=””, menuId=””, sqld=””, crerNo=”“)를 통하여 서비스와 Aop JoinPoint 인자값으로
받을 수 있도록 개발했다. Aop에서 전달받은 인자를 자바 reflection을 이용하여 generic하게 각각의 호출하는 서비스의 reqDto로 
typeCasting하여 mybatis에 queryParam으로 사용할 수 있도록 했다. 위 개발을 진행하면서 reflection과 aop에 대해 알 수 있는
시간이었다.</p>

<p>결론부터 말하면 1번은 아직 과제로 남아있고 2번은 성공하여 공통에 반영된것을 확인했다.</p>

<h3 id="아직-해결하지-못한-mask-어노테이션-개발--글을-작성하며-test-code를-작성해서-성공시켰다-20241223일-업무시간에-적용-성공했다">아직 해결하지 못한 @Mask 어노테이션 개발 ( 글을 작성하며 test code를 작성해서 성공시켰다.. 2024.12.23일 업무시간에 적용 성공했다..)</h3>
<p>우선 1번 문제를 해결하기 위해 통신하는 시점에 직렬화를 처리해줄 JsonSerialize, Enum, Annotation을 이용하여 만들어보려 했다.
잘 정리된 오픈 소스가 많으니 간단하게 직렬화, 역직렬화 시점에 어떻게 마스킹을 적용하는지에 대해서만 간단하게 알아보고 어떤 어려움을 겪어
이 방법을 끝내 성공시키지 못했는지에 대해서만 작성해보려고 한다.</p>

<h4 id="1masked-annotation-생성">1.@Masked Annotation 생성</h4>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Target</span><span class="o">({</span><span class="nc">ElementType</span><span class="o">.</span><span class="na">FIELD</span><span class="o">})</span>
<span class="nd">@Retention</span><span class="o">(</span><span class="nc">RetentionPolicy</span><span class="o">.</span><span class="na">RUNTIME</span><span class="o">)</span>
<span class="kd">public</span> <span class="nd">@interface</span> <span class="nc">MaskApply</span> <span class="o">{</span>
    <span class="nc">MaskType</span> <span class="nf">value</span><span class="o">();</span>
<span class="o">}</span>
</code></pre></div></div>

<p>위 어노테이션이 적용된 field에 masking 처리를 적용한다. MaskType은 Enum으로 어떤 마스킹을 적용할지에 대한 타입을 명시한다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">enum</span> <span class="nc">MaskType</span> <span class="o">{</span>
  <span class="no">PHONE</span><span class="o">,</span> <span class="no">ID</span><span class="o">,</span> <span class="no">NAME</span><span class="o">,</span> <span class="no">CONTACT</span><span class="o">,</span> <span class="no">DETAIL_ADDRESS</span><span class="o">,</span> <span class="no">EMAIL</span><span class="o">;</span>
<span class="o">}</span>
</code></pre></div></div>

<p><strong>spring beanProperty</strong>
spring에서 bean property는 아래와 같은 역할을 한다.</p>

<ol>
  <li>DI : 어노테이션이나 xml기반의 설정에서 객체 속성을 설정할 때</li>
  <li>Data binding: controller 레이어에서 폼 데이터를 객체로 바인딩</li>
  <li>validation: bean validation api 사용시</li>
</ol>

<p>나는 jackson을 사용하여 bean property에 접근하기 때문에 jackson에서 활용을 알아보자.
jackson은 javabean의 getter와 setter 기준으로 필드를 매핑하며 이는 데이터의 직렬화/역직렬화에 beanProperty가 사용된다는 의미이다.
나는 masking annotation이 적용된 Field의 Type을 불러오기 위해 사용했다. 내부 함수를 살펴보면 결국 jackson의 Std는 Bean property 인터페이스의
구현체로 볼 수 있다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">interface</span> <span class="nc">BeanProperty</span> <span class="kd">extends</span> <span class="nc">Named</span> <span class="o">{</span>
    <span class="nc">String</span> <span class="nf">getName</span><span class="o">();</span>

    <span class="nc">JavaType</span> <span class="nf">getType</span><span class="o">();</span>

    <span class="o">&lt;</span><span class="no">A</span> <span class="kd">extends</span> <span class="nc">Annotation</span><span class="o">&gt;</span> <span class="no">A</span> <span class="nf">getAnnotation</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">A</span><span class="o">&gt;</span> <span class="n">var1</span><span class="o">);</span>

    <span class="o">&lt;</span><span class="no">A</span> <span class="kd">extends</span> <span class="nc">Annotation</span><span class="o">&gt;</span> <span class="no">A</span> <span class="nf">getContextAnnotation</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">A</span><span class="o">&gt;</span> <span class="n">var1</span><span class="o">);</span>

    <span class="nc">AnnotatedMember</span> <span class="nf">getMember</span><span class="o">();</span>

    <span class="kd">public</span> <span class="kd">static</span> <span class="kd">class</span> <span class="nc">Std</span> <span class="kd">implements</span> <span class="nc">BeanProperty</span> <span class="o">{</span>
        <span class="kd">protected</span> <span class="kd">final</span> <span class="nc">String</span> <span class="n">_name</span><span class="o">;</span>
        <span class="kd">protected</span> <span class="kd">final</span> <span class="nc">JavaType</span> <span class="n">_type</span><span class="o">;</span>
        <span class="kd">protected</span> <span class="kd">final</span> <span class="nc">AnnotatedMember</span> <span class="n">_member</span><span class="o">;</span>
        <span class="kd">protected</span> <span class="kd">final</span> <span class="nc">Annotations</span> <span class="n">_contextAnnotations</span><span class="o">;</span>

        <span class="kd">public</span> <span class="nf">Std</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="nc">JavaType</span> <span class="n">type</span><span class="o">,</span> <span class="nc">Annotations</span> <span class="n">contextAnnotations</span><span class="o">,</span> <span class="nc">AnnotatedMember</span> <span class="n">member</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">this</span><span class="o">.</span><span class="na">_name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">_type</span> <span class="o">=</span> <span class="n">type</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">_member</span> <span class="o">=</span> <span class="n">member</span><span class="o">;</span>
            <span class="k">this</span><span class="o">.</span><span class="na">_contextAnnotations</span> <span class="o">=</span> <span class="n">contextAnnotations</span><span class="o">;</span>
        <span class="o">}</span>


        <span class="kd">public</span> <span class="o">&lt;</span><span class="no">A</span> <span class="kd">extends</span> <span class="nc">Annotation</span><span class="o">&gt;</span> <span class="no">A</span> <span class="nf">getAnnotation</span><span class="o">(</span><span class="nc">Class</span><span class="o">&lt;</span><span class="no">A</span><span class="o">&gt;</span> <span class="n">acls</span><span class="o">)</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">_member</span> <span class="o">==</span> <span class="kc">null</span> <span class="o">?</span> <span class="kc">null</span> <span class="o">:</span> <span class="k">this</span><span class="o">.</span><span class="na">_member</span><span class="o">.</span><span class="na">getAnnotation</span><span class="o">(</span><span class="n">acls</span><span class="o">);</span>
        <span class="o">}</span>
  
      <span class="o">...</span>

        <span class="kd">public</span> <span class="nc">JavaType</span> <span class="nf">getType</span><span class="o">()</span> <span class="o">{</span>
            <span class="k">return</span> <span class="k">this</span><span class="o">.</span><span class="na">_type</span><span class="o">;</span>
        <span class="o">}</span>
  
    <span class="o">...</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">MaskStringSerializer</span> <span class="kd">extends</span> <span class="nc">StdSerializer</span><span class="o">&lt;</span><span class="nc">String</span><span class="o">&gt;</span> <span class="kd">implements</span> <span class="nc">ContextualSerializer</span> <span class="o">{</span>

    <span class="nc">MaskType</span> <span class="n">maskType</span><span class="o">;</span>

    <span class="kd">protected</span> <span class="nf">MaskStringSerializer</span><span class="o">()</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
    <span class="o">}</span>
    
    <span class="kd">protected</span> <span class="nf">MaskStringSerializer</span><span class="o">(</span><span class="nc">MaskType</span> <span class="n">maskType</span><span class="o">)</span> <span class="o">{</span>
        <span class="kd">super</span><span class="o">(</span><span class="nc">String</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="k">this</span><span class="o">.</span><span class="na">maskType</span> <span class="o">=</span> <span class="n">maskType</span><span class="o">;</span>

    <span class="o">}</span>

    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">serialize</span><span class="o">(</span><span class="nc">String</span> <span class="n">s</span><span class="o">,</span> <span class="nc">JsonGenerator</span> <span class="n">jsonGenerator</span><span class="o">,</span> <span class="nc">SerializerProvider</span> <span class="n">serializerProvider</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">IOException</span><span class="o">,</span> <span class="nc">JsonGenerationException</span> <span class="o">{</span>
        <span class="k">try</span> <span class="o">{</span>
            <span class="n">jsonGenerator</span><span class="o">.</span><span class="na">writeString</span><span class="o">(</span><span class="nc">MaskingUtil</span><span class="o">.</span><span class="na">mask</span><span class="o">(</span><span class="n">maskType</span><span class="o">,</span> <span class="n">s</span><span class="o">));</span>
        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="nc">RuntimeException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
        <span class="o">}</span>
    <span class="o">}</span>

    <span class="cm">/**
     *
     * @param serializerProvider
     * @param beanProperty
     * @return
     * @throws JsonMappingException
     * 해당 어노테이션이 적용되어 있을 경우 마스킹 타입으로 MaskStringSerializer로 반환
     */</span>
    <span class="nd">@Override</span>
    <span class="kd">public</span> <span class="nc">JsonSerializer</span><span class="o">&lt;?&gt;</span> <span class="n">createContextual</span><span class="o">(</span><span class="nc">SerializerProvider</span> <span class="n">serializerProvider</span><span class="o">,</span> <span class="nc">BeanProperty</span> <span class="n">beanProperty</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">JsonMappingException</span> <span class="o">{</span>
        <span class="nc">MaskApply</span> <span class="n">maskApply</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="nc">MaskType</span> <span class="n">maskType</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
        <span class="c1">// jackson에서 제공하는 beanProperty</span>
        <span class="k">if</span> <span class="o">(</span><span class="n">beanProperty</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">maskApply</span> <span class="o">=</span> <span class="n">beanProperty</span><span class="o">.</span><span class="na">getAnnotation</span><span class="o">(</span><span class="nc">MaskApply</span><span class="o">.</span><span class="na">class</span><span class="o">);</span>
        <span class="o">}</span>
        <span class="k">if</span><span class="o">(</span><span class="n">maskApply</span> <span class="o">!=</span> <span class="kc">null</span><span class="o">)</span> <span class="o">{</span>
            <span class="n">maskType</span> <span class="o">=</span> <span class="n">maskApply</span><span class="o">.</span><span class="na">type</span><span class="o">();</span>
        <span class="o">}</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">MaskStringSerializer</span><span class="o">(</span><span class="n">maskType</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<h3 id="성공하여-공통에-기여한-maskapplylog">성공하여 공통에 기여한 @MaskApplyLog</h3>

<p>위 과정을 진행하면서 내가 학습한 내용을 업무에 적용할 수 있어서 행복했고 동료들도 좋은 피드백을 해주어 기뻣다. 환경이 열악하거나
개발되어 있지 않다면 항상 고민하며 학습해보고 업무에 적용하려고 노력하면 해낼 수 있다고 느낄 수 있는 값진 시간이었다.</p>

<p>MaskApplyLog는 어노테이션을 기반으로 AOP의 @After를 통하여 로깅한다. 마스킹이 정상적으로 해제 될 시에 RDB에 특정 사용자와 메뉴가 마스킹 해제 로직을 탔는지 저장한다. 기존에
사용하던 방식은 모든 Service가 로그를 쌓는 서비스에 의존하여 호출하는 방식으로 동작했다. 하지만 MaskApplyLog를 사용할 시에 각 서비스에서의 의존성을 제거하고 annotation의
파라미터로 값을 넘겨주면 아래와 같이 request의 타입캐스팅을 통해 본 쿼리의 실행을 대리하며 정상적인 로직을 처리할 수 있었다.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">T</span> <span class="n">t</span> <span class="o">=</span> <span class="n">clazz</span><span class="o">.</span><span class="na">cast</span><span class="o">(</span><span class="n">response</span><span class="o">);</span>
</code></pre></div></div>

<h2 id="composite-pattern-factory-pattern을-판매원장에-녹이기">Composite Pattern, Factory Pattern을 판매원장에 녹이기</h2>

<p>공부를 해도 실전에 적용해보며 고민하지 않으니 학습이 제대로 됐는지 확인할 방법이 없었다. 실제로 production에 적용할 수 있어야
제대로 학습했다라고 생각했다. 실제로 적절한 서비스가 있어 학습했던 내용을 더듬고 고민하여 원장에 도입해보았다.
간단하게 어떤 구조로 작성했는지 코드를 통해 정리하려고 한다.</p>

<h2 id="test-code-작성">test code 작성</h2>
<blockquote>
  <p>coverage를 70% 이상 기록해보기</p>
</blockquote>

<p>위 목표를 달성하면서 봉착했던 문제와 습득한 기술에 대하여 간략하게 기록하려고 한다.</p>
<ul>
  <li>service 레이어 -&gt; mocking 으로 테스트할 수 있다.
    <ul>
      <li>현재 개발에 참여하고 있는 프로젝트에서는 mybatis를 사용하고 있다. 어떻게 하면 mybatis까지 커버하여 테스트할 수 있을지</li>
      <li>그래서 우선 mockito를 활용하여 테스트하였다.</li>
    </ul>
  </li>
  <li>controller 레이어 -&gt; @SpringBootTest, @WebMvcTest 어떤걸 이용해야 하며 controller 레이어에서 사용하고 있는 클래스의 의존성 문제를 어떻게 해결할 것인가.</li>
</ul>

<p>현재 프로젝트는 여러개의 모듈로 구성된 msa 구조로 작성되어 있고 내가 테스트를 하려고 하는 모듈은 서브 모듈로 의존성을 따로 주입하지 않으면,
@SpringBootTest를 진행할 수 없다.
위 문제를 공통 설정이나 config를 변경하지 않고 해결하려고 노력했으나 단위테스트로 코드 검증을 진행하는 방식으로 test code를 작성하는 것으로
마무리됐다. 아직 끝나지 않았지만 해결하기 위해 새로 알게된 내용이나 인사이트에 대해 공유하려고 한다.</p>

<p><strong>새로 알게된 내용</strong></p>
<ol>
  <li>의존성 주입에 대한 중요성</li>
  <li>test fixture</li>
  <li>mock과 spy의 간단한 차이점</li>
</ol>

<h3 id="의존성-주입에-대한-중요성">의존성 주입에 대한 중요성</h3>
<p>Test Code를 이전에는 작성해본 경험이 없기에 정확이 스텁 테스트나 통합 테스트 그 어떠한 개념이 머릿속에 존재하지 않았다. 그 와중에 next step에서 제공하는 tdd 자바 플레이그라운드라는
tdd를 약하게 접해볼 수 있는 교육을 들으며 테스트의 막강함과 중요성에 대하여 깨달았다.
주제와 무관하지만 이러한 서사가 누구도 작성하지 않았던 테스트 코드를 이번 프로젝트를 계기로 시작해본 것이다.
@SpringBootTest는 테스트하려는 소스를 대상으로 모든 의존관계가 성립해야 한다.</p>

<h2 id="java-8을-최대한-활용하여-개발하기">Java 8을 최대한 활용하여 개발하기</h2>
<blockquote>
  <p>Optional, stream을 이용하여 선언적으로 개발해보자</p>
</blockquote>

<p><strong>stream은 보면 볼수록 직관적이다.</strong>
예를 들어 다음과 같은 for문을 stream 한줄로 summary할 수 있으며 사용자 측면에서도 매우 직관적이다. 아래 간단한 예시로 확인해보자.</p>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nd">@Test</span>
<span class="kt">void</span> <span class="nf">testStreamAndForLoop</span><span class="o">()</span> <span class="o">{</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">numbers</span> <span class="o">=</span> <span class="nc">List</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="mi">1</span><span class="o">,</span> <span class="mi">2</span><span class="o">,</span> <span class="mi">3</span><span class="o">,</span> <span class="mi">4</span><span class="o">,</span> <span class="mi">5</span><span class="o">,</span> <span class="mi">6</span><span class="o">,</span> <span class="mi">7</span><span class="o">,</span> <span class="mi">8</span><span class="o">,</span> <span class="mi">9</span><span class="o">,</span> <span class="mi">10</span><span class="o">);</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">resultForForLoop</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>
  <span class="nc">List</span><span class="o">&lt;</span><span class="nc">Integer</span><span class="o">&gt;</span> <span class="n">resultForForStream</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">ArrayList</span><span class="o">&lt;&gt;();</span>

  <span class="k">for</span> <span class="o">(</span><span class="nc">Integer</span> <span class="n">number</span> <span class="o">:</span> <span class="n">numbers</span><span class="o">)</span> <span class="o">{</span>
    <span class="k">if</span><span class="o">(</span><span class="n">number</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="o">){</span>
      <span class="n">resultForForLoop</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">number</span><span class="o">);</span>
    <span class="o">}</span>
  <span class="o">}</span>
  <span class="n">numbers</span><span class="o">.</span><span class="na">stream</span><span class="o">().</span><span class="na">filter</span><span class="o">(</span><span class="n">number</span> <span class="o">-&gt;</span> <span class="n">number</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="o">).</span><span class="na">forEach</span><span class="o">(</span><span class="n">number</span> <span class="o">-&gt;</span> <span class="n">resultForForStream</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">number</span><span class="o">));</span>

  <span class="n">assertEquals</span><span class="o">(</span><span class="n">resultForForLoop</span><span class="o">,</span> <span class="n">resultForForStream</span><span class="o">);</span>
<span class="o">}</span>
</code></pre></div></div>
<p>테스트가 통과하는 것을 확인할 수 있다. stream에 관련한 성능 이슈도 있지만 가독성 좋은 코드는 뛰어난 강점이 있다고 생각한다.</p>

<p><img src="../_img/stream_test_success.png" alt="img.png" /></p>

<h2 id="history">History</h2>
<h3 id="사이트-관리">사이트 관리</h3>
<p>ENM에서 재무관리 시스템 개발 이후 본사에서 Coding Assistant에 대한 TF로 약 1달의 시간을 보냈다. 정확히 1달이 다 되어 갈 무렵 팀장님이 차주 월요일부터 CGV 프로젝트에 투입될 것이라고 말씀해주셨다. 사이트는 어떤 개발을 진행하게 될지에 대해 
약간 막막함도 있었다. 사이트에서 어떤걸 개발하게 될지와 아직 사용해보지 않은 React에 대한 걱정이 심했던 기억이 있다.</p>

<h3 id="판매-결제-할인-그리고-적립">판매, 결제, 할인 그리고 적립..</h3>
<p>처음 프로젝트에 투입될 당시, 사이트 관리나 React 작업에 대해 걱정이 있었지만, 실제로는 전혀 문제가 되지 않았다. 역시 어떤 일이든 직접 부딪혀봐야 진짜로 알 수 있다는 점을 다시 한번 깨달았다. ㅋ.ㅋ
프로젝트 초반, PL님께서 내가 주로 판매와 결제와 관련된 조회성 화면만 개발할 것이라고 하셨다. 처음에는 “조회성 개발만 하면 되는 건가? 그렇다면 도메인에 대한 깊은 이해가 꼭 필요할까?”라는 의문이 들었다.
그러나 약 2개월간 프로젝트에 참여하며 CGV에서 사용되는 영업, 판매, 결제, 인터페이스 관련 도메인을 전반적으로 파악하고, 이를 기반으로 개발을 진행했다. 단순히 조회 화면을 개발하는 데 그치지 않고, 
넓고 복잡한 비즈니스 로직을 이해하면서 업무를 진행해야 했던 점은 다소 어려웠지만, 도메인을 깊이 이해하는 계기가 되었다.
특히 AS-IS 구조에서 자주 사용되던 예매 테이블과 결제_카드 정산 테이블이 TO-BE 설계에서 제외되면서, 새로운 설계에 적응하고 이를 기반으로 코드를 작성하는 데 고민과 노력이 필요했다.</p>

<p>비록 실제 코드를 모두 담아낼 수는 없지만, 프로젝트를 통해 배운 점과 업무에 적용했던 사례를 기록하며, 개발자로서 성장해 나가고 있음을 확인할 수 있었다.</p>]]></content><author><name>[&quot;이현동&quot;]</name></author><category term="Work" /><category term="project" /><summary type="html"><![CDATA[프로젝트 투입전 목표]]></summary></entry><entry><title type="html">Static과 메모리 구조</title><link href="http://localhost:4000/java/2024/08/03/java-01.html" rel="alternate" type="text/html" title="Static과 메모리 구조" /><published>2024-08-03T00:00:00+09:00</published><updated>2024-08-03T00:00:00+09:00</updated><id>http://localhost:4000/java/2024/08/03/java-01</id><content type="html" xml:base="http://localhost:4000/java/2024/08/03/java-01.html"><![CDATA[<h1 id="content">Content</h1>
<ul>
  <li>자바 메모리 구조</li>
  <li>static</li>
</ul>

<h2 id="자바-메모리-구조">자바 메모리 구조</h2>
<ul>
  <li>메서드 영역 :클래스의 정보</li>
  <li>스택 영역 :실제 프로그램이 실행시 호출되는 메서드가 쌓임</li>
  <li>힙 영역 :객체(인스턴스)</li>
</ul>

<h3 id="메서드-영역">메서드 영역</h3>
<blockquote>
  <p>프로그램을 실행하는데 필요한 공통 데이터를 관리한다. 프로그램의 모든 영역에서 공유</p>
</blockquote>

<ul>
  <li>클래스 정보 (클래스, 메서드 실행코드)
    <ul>
      <li>바이트코드, 필드, 메서드와 생성자 코드 등 모든 실행 코드</li>
    </ul>
  </li>
  <li>static 영역 (static 변수 보관)</li>
  <li>상수 (string literal, 12…)</li>
</ul>

<h3 id="스택-영역">스택 영역</h3>
<blockquote>
  <p>스레드별로 스택이 생성되며, 하나의 실행 단위마다 스택이 생성된다. 지역 변수, 연산결과 메서드 호출 정보등을 저장한다.</p>
</blockquote>

<ul>
  <li>스택프레임 :메서드를 호출할때마다 스택 프레임에 쌓이고 종료되면 stack에서 pop된다.</li>
</ul>]]></content><author><name>[&quot;이현동&quot;]</name></author><category term="Java" /><category term="java" /><summary type="html"><![CDATA[Content 자바 메모리 구조 static]]></summary></entry><entry><title type="html">[effective-java] 빌더를 고려해야 하는 이유</title><link href="http://localhost:4000/effective-java/2024/07/31/effective-java-item02.html" rel="alternate" type="text/html" title="[effective-java] 빌더를 고려해야 하는 이유" /><published>2024-07-31T00:00:00+09:00</published><updated>2024-07-31T00:00:00+09:00</updated><id>http://localhost:4000/effective-java/2024/07/31/%5Beffective%20java%5D-item02</id><content type="html" xml:base="http://localhost:4000/effective-java/2024/07/31/effective-java-item02.html"><![CDATA[<h1 id="item2-생성자에-매개변수가-많다면-빌더를-고려하라">Item2. 생성자에 매개변수가 많다면 빌더를 고려하라</h1>

<blockquote>
  <p>일반 생성자는 선택적 매개변수가 많을경우 적절히 대응하기가 어렵다.</p>
</blockquote>

<p>영양정보 클래스를 통하여 좀 더 이해해보도록 하자.</p>

<h2 id="점층적-생성자-패턴확장-어려움">점층적 생성자 패턴(확장 어려움)</h2>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NutritionFacts</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servingSize</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">calories</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">fat</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">sodium</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">carbohydrate</span><span class="o">;</span>

    <span class="kd">public</span> <span class="nf">NutritionFacts</span><span class="o">(</span><span class="kt">int</span> <span class="n">servingSize</span><span class="o">,</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">,</span> <span class="kt">int</span> <span class="n">calories</span><span class="o">,</span> <span class="kt">int</span> <span class="n">fat</span><span class="o">,</span> <span class="kt">int</span> <span class="n">sodium</span><span class="o">,</span> <span class="kt">int</span> <span class="n">carbohydrate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">servingSize</span> <span class="o">=</span> <span class="n">servingSize</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">servings</span> <span class="o">=</span> <span class="n">servings</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">calories</span> <span class="o">=</span> <span class="n">calories</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">fat</span> <span class="o">=</span> <span class="n">fat</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">sodium</span> <span class="o">=</span> <span class="n">sodium</span><span class="o">;</span>
        <span class="k">this</span><span class="o">.</span><span class="na">carbohydrate</span> <span class="o">=</span> <span class="n">carbohydrate</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">NutritionFacts</span><span class="o">(</span><span class="kt">int</span> <span class="n">servingSize</span><span class="o">,</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="n">servingSize</span><span class="o">,</span> <span class="n">servings</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">NutritionFacts</span><span class="o">(</span><span class="kt">int</span> <span class="n">servingSize</span><span class="o">,</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">,</span> <span class="kt">int</span> <span class="n">calories</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">(</span><span class="n">servingSize</span><span class="o">,</span> <span class="n">servings</span><span class="o">,</span> <span class="n">calories</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">NutritionFacts</span><span class="o">(</span><span class="kt">int</span> <span class="n">servingSize</span><span class="o">,</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">,</span> <span class="kt">int</span> <span class="n">calories</span><span class="o">,</span> <span class="kt">int</span> <span class="n">fat</span><span class="o">){</span>
        <span class="k">this</span><span class="o">(</span><span class="n">servingSize</span><span class="o">,</span> <span class="n">servings</span><span class="o">,</span> <span class="n">calories</span><span class="o">,</span> <span class="n">fat</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="nf">NutritionFacts</span><span class="o">(</span><span class="kt">int</span> <span class="n">servingSize</span><span class="o">,</span> <span class="kt">int</span> <span class="n">servings</span><span class="o">,</span> <span class="kt">int</span> <span class="n">calories</span><span class="o">,</span> <span class="kt">int</span> <span class="n">fat</span><span class="o">,</span> <span class="kt">int</span> <span class="n">sodium</span><span class="o">){</span>
        <span class="k">this</span><span class="o">(</span><span class="n">servingSize</span><span class="o">,</span> <span class="n">servings</span><span class="o">,</span> <span class="n">calories</span><span class="o">,</span> <span class="n">fat</span><span class="o">,</span> <span class="n">sodium</span><span class="o">,</span> <span class="mi">0</span><span class="o">);</span>
    <span class="o">}</span>
<span class="o">}</span>

</code></pre></div></div>

<p>점층적 생성자 패턴으로 필수 매개변수와 선택 매개변수 1개를 받는 생성자 모두 받는 생성자까지 점차 생성자 매개변수를 늘리는 방식이다.
이 클래스의 인스턴스를 만들려면 원하는 매개변수를 모두 포함한 생성자 중 가장 짧은 것을 골라 호출하면 된다.</p>

<p><strong>점층적 생성자 패턴도 쓸 수 있지만, 매개변수가 많아지면 클라이언트 코드를 작성하거나 읽는데 어려움이 있다.</strong></p>

<h2 id="자바빈즈-패턴javabeans-pattern일관성이-깨지고-불변-x">자바빈즈 패턴(JavaBeans pattern)(일관성이 깨지고 불변 x)</h2>
<blockquote>
  <p>매개변수가 없는 생성자로 객체를 만들어 세터 메서드를 호출하여 원하는 매개변수 값을 설정하는 방식</p>
</blockquote>

<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kd">public</span> <span class="kd">class</span> <span class="nc">NutritionFactsWithJavaBeansPattern</span> <span class="o">{</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">servingSize</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span> <span class="c1">// Required; no default value</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">servings</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="o">;</span> <span class="c1">// Required; no default value</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">calories</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">fat</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">sodium</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">carbohydrate</span><span class="o">=</span><span class="mi">0</span><span class="o">;</span>
    
    <span class="kd">public</span> <span class="nf">NutritionFactsWithJavaBeansPattern</span><span class="o">()</span> <span class="o">{</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setServingSize</span><span class="o">(</span><span class="kt">int</span> <span class="n">servingSize</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">servingSize</span> <span class="o">=</span> <span class="n">servingSize</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setServings</span><span class="o">(</span><span class="kt">int</span> <span class="n">servings</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">servings</span> <span class="o">=</span> <span class="n">servings</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCalories</span><span class="o">(</span><span class="kt">int</span> <span class="n">calories</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">calories</span> <span class="o">=</span> <span class="n">calories</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setFat</span><span class="o">(</span><span class="kt">int</span> <span class="n">fat</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">fat</span> <span class="o">=</span> <span class="n">fat</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setSodium</span><span class="o">(</span><span class="kt">int</span> <span class="n">sodium</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">sodium</span> <span class="o">=</span> <span class="n">sodium</span><span class="o">;</span>
    <span class="o">}</span>

    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">setCarbohydrate</span><span class="o">(</span><span class="kt">int</span> <span class="n">carbohydrate</span><span class="o">)</span> <span class="o">{</span>
        <span class="k">this</span><span class="o">.</span><span class="na">carbohydrate</span> <span class="o">=</span> <span class="n">carbohydrate</span><span class="o">;</span>
    <span class="o">}</span>
<span class="o">}</span>
</code></pre></div></div>

<p>자바빈즈 패턴은 객체 하나를 만들려면 메서드를 여러개 호출해야 하고, 객체가 완전이 생성되기 전까지 일관성이 무너진 상태에 놓이게 된다.</p>]]></content><author><name>[&quot;이현동&quot;]</name></author><category term="effective-java" /><category term="java" /><summary type="html"><![CDATA[Item2. 생성자에 매개변수가 많다면 빌더를 고려하라]]></summary></entry><entry><title type="html">[effective-java] 정적 팩터리 메서드를 고려해야 하는 이유</title><link href="http://localhost:4000/effective-java/2024/07/25/effective-java-item01.html" rel="alternate" type="text/html" title="[effective-java] 정적 팩터리 메서드를 고려해야 하는 이유" /><published>2024-07-25T00:00:00+09:00</published><updated>2024-07-25T00:00:00+09:00</updated><id>http://localhost:4000/effective-java/2024/07/25/%5Beffective%20java%5D-item01</id><content type="html" xml:base="http://localhost:4000/effective-java/2024/07/25/effective-java-item01.html"><![CDATA[<h2 id="item1-생성자-대신-정적-팩터리--메서드-고려하라">Item1. 생성자 대신 정적 팩터리  메서드 고려하라</h2>

<h3 id="1">1</h3>
<p>팩토리 메서드 패턴으로 기능에 따라 이름을 가질 수 있음.</p>
<div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">package</span> <span class="nn">com.org.lhd.effectivejava3.item01</span><span class="o">;</span>  
  
<span class="kd">public</span> <span class="kd">class</span> <span class="nc">Member</span> <span class="o">{</span>  
    <span class="kd">private</span> <span class="nc">String</span> <span class="n">name</span><span class="o">;</span>  
  
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">height</span><span class="o">;</span>  
  
    <span class="kd">private</span> <span class="kt">int</span> <span class="n">age</span><span class="o">;</span>  
  
  
    <span class="kd">public</span> <span class="nf">Member</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">height</span><span class="o">)</span> <span class="o">{</span>  
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>  
        <span class="k">this</span><span class="o">.</span><span class="na">height</span> <span class="o">=</span> <span class="n">height</span><span class="o">;</span>  
    <span class="o">}</span>  
  
    <span class="kd">public</span> <span class="nf">Member</span><span class="o">(</span><span class="nc">String</span> <span class="n">name</span><span class="o">,</span> <span class="kt">int</span> <span class="n">age</span><span class="o">)</span> <span class="o">{</span>  
        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>  
        <span class="k">this</span><span class="o">.</span><span class="na">age</span> <span class="o">=</span> <span class="n">age</span><span class="o">;</span>  
    <span class="o">}</span>  
<span class="o">}</span>
</code></pre></div></div>
<p>위의 예시처럼 자바에서는 같은 파라미터 타입을 가지는 생성자를 만들게 되면 오류가 발생함.</p>

<h3 id="2">2</h3>
<p>자바의 생성자는 매번 새로운 인스턴스를 만들어 진다. (hashcode로 조회해볼 수 있음)
생성자를 통하여 인스턴스를 만들어주면 통제가 불가능함. 유일한 인스턴스만 만들어야 한다면 정적 팩터리 인스턴스를 만들어서 사용해야함. (객체 생성을 막아버려 존재하는 인스턴스를 가져오게 할 수 있음.) - flyweight pattern</p>

<h3 id="3">3</h3>

<p><strong>정리</strong></p>
<ol>
  <li>이름을 가질 수 있음</li>
  <li>매번 객체를 생성하여 사용하지 않음.</li>
  <li>반환 타입의 하위 타입 객체를 반환할 수 있는 능력이 있음.</li>
  <li>입력 매개변수에 따라 매번 다른 클래스의 객체를 반환할 수 있음.
    <ul>
      <li>하위 클래스이기만 하면 되고 클라이언트 입장에서 두 클래스 존재를 모른다.</li>
    </ul>
  </li>
  <li>정적 팩터리 메서드를 작성하는 시점에는 반환할 객체의 클래스가 존재하지 않아도 됨.
    <ul>
      <li>서비스 프레임워크를 만드는 근간</li>
    </ul>
  </li>
</ol>

<ul>
  <li>열거 타입은 인스턴스가 하나만 만들어짐을 보장</li>
  <li>같은 객체가 자주 요청되는 상황이라면 플라이웨이트 패턴을 사용할 수 있음</li>
  <li>인터페이스가 정적 메서드를 가질 수 없다는 제한이 풀렸기 때문에 인스턴스화 불가 동반 클래스를 둘 이유가 별로 없음</li>
  <li>서비스 제공자 프레임워크를 만드는 근간 -&gt; 정적 팩터리 메서드</li>
  <li>서비스 제공자 인터페이스가 없다면 각 구현체를 인스턴스로 만들 때 리플렉션을 사용</li>
  <li>브리지 패턴</li>
  <li>의존 객체 주입 프레임워크</li>
</ul>

<h2 id="추가-공부해야-하는-내용">추가 공부해야 하는 내용</h2>
<h3 id="열거-타입">열거 타입</h3>
<h3 id="플라이웨이트-패턴">플라이웨이트 패턴</h3>
<h3 id="인터페이스와-정적-메서드">인터페이스와 정적 메서드</h3>
<h3 id="리플렉션">리플렉션</h3>
<h2 id="서비스-제공자-프레임워크">서비스 제공자 프레임워크</h2>]]></content><author><name>[&quot;이현동&quot;]</name></author><category term="effective-java" /><category term="java" /><summary type="html"><![CDATA[Item1. 생성자 대신 정적 팩터리 메서드 고려하라]]></summary></entry></feed>